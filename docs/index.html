<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç­ç´šåˆé¤è¨‚å–®ç³»çµ±ï¼ˆå‰ç«¯ï¼‰</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* è®“æ•´é å¯ä»¥æ²å‹•åˆ°æœ€åº•ï¼Œé¿å… 100vh / overflow é™åˆ¶ */
    html, body { height: auto; min-height: 100%; overflow-y: auto; }
    #app { min-height: 100vh; height: auto; overflow: visible; }
    section { height: auto !important; overflow: visible !important; }
    .card { overflow: visible; }

    /* Admin å…¨éƒ¨åº§è™Ÿä¸€è¦½ */
    #allSeatsGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px}
    .seat-card{border:1px solid #3a2d19;background:#1b140d;border-radius:10px;padding:10px}
    .seat-card .hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .badge{padding:2px 8px;border-radius:999px;font-size:12px;border:1px solid #555}
    .badge.ok{background:#103a1a;border-color:#1f7a35}
    .badge.pending{background:#3a2a10;border-color:#a36b1a}
    .seat-actions{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .items{font-size:12px;color:#d8d8d8}
  </style>
</head>
<body>
  <!-- ç™»å…¥å±¤ -->
  <div id="loginLayer" class="layer">
    <div class="card w400">
      <h2>å¾Œå°ç™»å…¥</h2>
      <input id="loginUser" placeholder="å¸³è™Ÿ" />
      <input id="loginPass" placeholder="å¯†ç¢¼" type="password" />
      <button id="loginBtn" class="primary">ç™»å…¥</button>
      <div id="loginMsg" class="muted small"></div>
    </div>
  </div>

  <!-- ä¸»ç•«é¢ -->
  <div id="app" class="hidden">
    <div class="topbar">
      <div class="left">
        <strong>ğŸ± ç­ç´šåˆé¤è¨‚å–®ç³»çµ±</strong>
        <span class="muted small" id="apiBaseHint"></span>
      </div>
      <div class="right">
        <button id="tabOrders" class="tab active">è¨‚å–®</button>
        <button id="tabMenus" class="tab">èœå–®</button>
        <button id="tabReports" class="tab">å¾Œå°</button>
        <button id="tabLogs" class="tab hidden">Logs</button>
        <button id="tabUsers" class="tab hidden">ä½¿ç”¨è€…</button>
        <!-- âœ… æ–°å¢ï¼šåƒ… admin é¡¯ç¤ºï¼Œä¸€éµæ²åˆ°ã€Œå…¨éƒ¨åº§è™Ÿã€ -->
        <button id="tabAllSeats" class="tab hidden">å…¨åº§è™Ÿ</button>
        <span id="whoami" class="pill"></span>
        <button id="logoutBtn">ç™»å‡º</button>
      </div>
    </div>

    <!-- è¨‚å–®é  -->
    <section id="pageOrders">
      <!-- éé»é¤æ™‚æ®µçš„æç¤ºæ©«å¹… -->
      <div id="closedBanner" class="card hidden" style="border:1px solid #f59e0b;background:#24190b;color:#ffd38a">
        <strong>ç›®å‰ä¸åœ¨é»é¤æ™‚æ®µ</strong>
        <div class="small">å¯é»é¤æ™‚é–“ç”±ç®¡ç†å“¡è¨­å®šï¼ˆé€±æœŸèˆ‡æ™‚æ®µï¼‰ã€‚ä¸€èˆ¬ä½¿ç”¨è€…åœ¨é—œé–‰æ™‚æ®µä¸å¯ä¿®æ”¹è¨‚å–®ã€‚</div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>é»é¤</h3>
          <div class="row">
            <label>åº§è™Ÿ
              <select id="seatSelect"></select>
            </label>
            <!-- è‹¥ä½ çš„èˆŠç‰ˆä»æœ‰æ­¤æŒ‰éˆ•å¯ä¿ç•™ï¼›æ²’æœ‰ä¹Ÿä¸å½±éŸ¿ -->
            <button id="toggleSubmitted" class="ghost">æ¨™è¨˜å®Œæˆ</button>
            <button id="clearSeat" class="danger">æ¸…ç©ºæœ¬åº§</button>
          </div>

          <div class="hr"></div>

          <details open>
            <summary><strong>ç”±èœå–®ä»£è™Ÿæ–°å¢</strong> <span class="muted small">ï¼ˆè¼¸å…¥ä»£è™Ÿèˆ‡æ•¸é‡ï¼Œå¦‚ <span class="kbd">1</span>ã€<span class="kbd">2</span>ï¼‰</span></summary>
            <div class="row mt8">
              <input id="codeInput" type="number" min="1" placeholder="ä»£è™Ÿ" class="w120" />
              <input id="qtyInput" type="number" min="1" value="1" placeholder="æ•¸é‡" class="w120" />
              <button id="addByCode" class="primary">åŠ å…¥</button>
            </div>
            <div id="menuView" class="small muted mt8"></div>
          </details>

          <details>
            <summary><strong>æ‰‹å‹•æ–°å¢é¤é»</strong></summary>
            <div class="row mt8">
              <input id="manualName" placeholder="å“å" />
              <input id="manualPrice" type="number" placeholder="å–®åƒ¹" class="w140" />
              <input id="manualQty" type="number" placeholder="æ•¸é‡" value="1" class="w120" />
              <button id="addManual" class="ghost">æ–°å¢</button>
            </div>
          </details>

          <!-- è‹¥éœ€è¦åœ¨å–®åº§ä½ä¸Šç›´æ¥åˆ‡æ›ã€Œå…§è¨‚ã€ï¼Œå¯åŠ ä¸‹é¢é€™è¡Œï¼ˆå¯é¸ï¼‰ï¼š
          <div class="row mt8">
            <label><input type="checkbox" id="internalOnly" /> å…§è¨‚ï¼ˆæ­¤åº§ä½ç”±ç­å°/è¡Œæ”¿çµ±ä¸€å…§éƒ¨è¨‚è³¼ï¼‰</label>
          </div>
          -->

          <div class="hr"></div>

          <h3>æœ¬åº§è¨‚å–®</h3>
          <table id="orderTable">
            <thead>
              <tr><th>#</th><th>å“å</th><th>å–®åƒ¹</th><th>æ•¸é‡</th><th>å°è¨ˆ</th><th></th></tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr><th colspan="4" style="text-align:right">å°è¨ˆ</th><th id="seatSubtotal">0</th><th></th></tr>
            </tfoot>
          </table>
        </div>

        <div class="card">
          <div class="section-title">
            <h3>ç›®å‰èœå–®</h3>
            <span id="activeMenuName" class="pill">(æœªé¸æ“‡)</span>
          </div>
          <div id="activeMenuList" class="small muted"></div>
        </div>
      </div>

      <!-- âœ… æ–°å¢ï¼šç®¡ç†å“¡ä¸€é çœ‹å®Œå…¨éƒ¨åº§è™Ÿ -->
      <div id="adminAllSeats" class="card hidden" style="margin-top:12px">
        <div class="section-title" style="display:flex;justify-content:space-between;align-items:center">
          <h3>å…¨éƒ¨åº§è™Ÿï¼ˆç®¡ç†å“¡å¿«é€Ÿæª¢è¦– / æ“ä½œï¼‰</h3>
          <button id="refreshAllSeats" class="ghost">é‡æ–°æ•´ç†</button>
        </div>
        <div id="allSeatsGrid"></div>
      </div>
    </section>

    <!-- èœå–®é  -->
    <section id="pageMenus" class="hidden">
      <div class="card">
        <h3>èœå–®ç®¡ç†</h3>
        <div class="row">
          <select id="menuSelect"></select>
          <button id="useMenu" class="primary">åˆ‡æ›å•Ÿç”¨</button>
          <button id="addMenu" class="ghost">æ–°å¢èœå–®</button>
        </div>
        <div class="row mt8">
          <input id="menuNewName" placeholder="æ–°èœå–®åç¨± / é‡æ–°å‘½å" />
          <button id="renameMenu">é‡æ–°å‘½å</button>
          <button id="dupMenu">è¤‡è£½</button>
          <button id="delMenu" class="danger">åˆªé™¤</button>
        </div>

        <div class="hr"></div>

        <div class="row">
          <input id="itemName" placeholder="å“å" />
          <input id="itemPrice" type="number" placeholder="åƒ¹æ ¼" class="w140" />
          <button id="addItem">æ–°å¢é …ç›®</button>
        </div>

        <table id="menuTable" class="mt8">
          <thead><tr><th>ä»£è™Ÿ</th><th>å“å</th><th>åƒ¹æ ¼</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- å¾Œå°é ï¼ˆå½™æ•´ï¼‹ç¼ºå–®ï¼‰ -->
    <section id="pageReports" class="hidden">
      <div class="grid">
        <div class="card">
          <h3>å“é …å½™æ•´</h3>
          <table id="aggTable">
            <thead><tr><th>å“å</th><th>ç¸½æ•¸</th><th>ç¸½é‡‘é¡</th></tr></thead>
            <tbody></tbody>
            <tfoot><tr><th colspan="2" style="text-align:right">å…¨ç­åˆè¨ˆ</th><th id="classTotal">0</th></tr></tfoot>
          </table>
        </div>

        <div class="card">
          <h3>å°šæœªå®Œæˆè¨‚å–®åå–®</h3>
          <div id="missingList" class="muted"></div>
        </div>
      </div>

      <div class="card mt8">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h3>åº§è™Ÿåˆè¨ˆèˆ‡æ˜ç´°</h3>
          <button id="loadBySeat" class="ghost">è¼‰å…¥/é‡æ–°æ•´ç†</button>
        </div>
        <div id="loadBySeatMsg" class="small muted"></div>
        <table>
          <thead><tr><th>åº§è™Ÿ</th><th>ç‹€æ…‹</th><th>å°è¨ˆ</th><th>æ˜ç´°</th></tr></thead>
          <tbody id="bySeatTBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Logsï¼ˆåƒ… adminï¼‰ -->
    <section id="pageLogs" class="hidden">
      <div class="card">
        <h3>å¯©è¨ˆç´€éŒ„ï¼ˆæœ€è¿‘ 500 ç­†ï¼‰</h3>
        <table id="logsTable">
          <thead>
            <tr><th>ID</th><th>æ™‚é–“</th><th>UserID</th><th>å‹•ä½œ</th><th>ç´°ç¯€</th><th>IP</th><th>UA</th></tr>
          </thead>
        <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ä½¿ç”¨è€…ç®¡ç†ï¼ˆåƒ… adminï¼‰ -->
    <section id="pageUsers" class="hidden">
      <div class="card">
        <h3>æ–°å¢ä½¿ç”¨è€…</h3>
        <div class="row">
          <input id="newUserName" placeholder="å¸³è™Ÿ" />
          <input id="newUserPass" placeholder="å¯†ç¢¼ (>=6)" type="password" />
          <select id="newUserRole">
            <option value="user">user</option>
            <option value="admin">admin</option>
          </select>
          <button id="createUserBtn" class="primary">å»ºç«‹</button>
        </div>
      </div>

      <div class="card mt8">
        <h3>ä½¿ç”¨è€…åˆ—è¡¨</h3>
        <table>
          <thead><tr><th>ID</th><th>å¸³è™Ÿ</th><th>è§’è‰²</th><th>é‡è¨­å¯†ç¢¼</th></tr></thead>
          <tbody id="usersTableBody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
